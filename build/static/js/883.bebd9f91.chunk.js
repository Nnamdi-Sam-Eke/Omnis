"use strict";(self.webpackChunkomnis=self.webpackChunkomnis||[]).push([[58,883],{5883:(e,t,a)=>{a.r(t),a.d(t,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var s=a(5043),n=a(7304),r=a(6058),o=a(5472),i=a(1362),l=a(2382),c=a(8326),u=a(579);n.t1.register(n.E8,n.PP,n.No,n.kc,n.m_,n.s$);const __WEBPACK_DEFAULT_EXPORT__=()=>{const[e,t]=(0,s.useState)([]),[a,n]=(0,s.useState)([]),[d,f]=(0,s.useState)({hours:0,minutes:0}),[m,h]=(0,s.useState)({hours:0,minutes:0}),[p,b]=(0,s.useState)(""),[g,x]=(0,s.useState)(""),[w,v]=(0,s.useState)(!1),[y,E]=(0,s.useState)("session"),[D,C]=(0,s.useState)("bar"),[j,k]=(0,s.useState)(!1),A=(0,o.aU)(),T=(0,i.xI)();(0,s.useEffect)((()=>{let e,t;const handleExit=async()=>{clearInterval(e);const a=T.currentUser;if(a&&t){const e=(0,o.H9)(A,"users",a.uid,"sessions",t);await(0,o.mZ)(e,{active:!1})}};return(0,i.hg)(T,(a=>{a&&(async a=>{const s=await(0,o.gS)((0,o.rJ)(A,"users",a.uid,"sessions"),{start:(0,o.O5)(),duration:0,active:!0});t=s.id;const n=(0,o.H9)(A,"users",a.uid,"sessions",t);e=setInterval((async()=>{const e=await(0,o.x7)(n);if(e.exists()){const t=e.data().duration||0;await(0,o.mZ)(n,{duration:t+60,lastUpdated:(0,o.O5)()})}}),6e4)})(a)})),window.addEventListener("beforeunload",handleExit),()=>{clearInterval(e),window.removeEventListener("beforeunload",handleExit)}}),[]),(0,s.useEffect)((()=>{(async()=>{const e=await(0,o.GG)((0,o.rJ)(A,"users"));let a=[];for(const t of e.docs){const e=t.id,s=(0,o.P)((0,o.rJ)(A,"users",e,"sessions"),(0,o.My)("start","asc"));(await(0,o.GG)(s)).forEach((t=>a.push({...t.data(),userId:e})))}t(a)})()}),[]),(0,s.useEffect)((()=>{(()=>{let t=0,a=0;const s=new Date,r=new Date;r.setHours(0,0,0,0);const o=p?new Date(p):null,i=g?new Date(g):null,l=e.filter((e=>{if(!e.start)return!1;const t=e.start.toDate?e.start.toDate():new Date(1e3*e.start.seconds);return(e.duration||0)>0&&(!o||t>=o)&&(!i||t<=i)}));l.forEach((e=>{const n=e.start.toDate?e.start.toDate():new Date(1e3*e.start.seconds),o=e.duration||0;t+=o;const i=new Date(n.getTime()+1e3*o),l=n<r?r:n,c=i>s?s:i;c>l&&(a+=Math.floor((c-l)/1e3))})),n(l),f({hours:Math.floor(t/3600),minutes:Math.floor(t%3600/60)}),h({hours:Math.floor(a/3600),minutes:Math.floor(a%3600/60)})})()}),[e,p,g]),(0,s.useEffect)((()=>{if(w){k(!0);const e=setTimeout((()=>k(!1)),3e3);return()=>clearTimeout(e)}}),[w]);const getData=()=>{const e="session"===y?a.map((e=>(e.duration||0)/3600)):Object.values(a.reduce(((e,t)=>{const a=(t.start.toDate?t.start.toDate():new Date(1e3*t.start.seconds)).toDateString();return e[a]=(e[a]||0)+(t.duration||0),e}),{})).map((e=>e/3600));return{labels:"session"===y?a.map(((e,t)=>`Session ${t+1}`)):Object.keys(a.reduce(((e,t)=>{const a=(t.start.toDate?t.start.toDate():new Date(1e3*t.start.seconds)).toDateString();return e[a]=(e[a]||0)+(t.duration||0),e}),{})),datasets:[{label:"session"===y?"Session Duration (hrs)":"Day Duration (hrs)",data:e,backgroundColor:"bar"===D?"#FF7F50":"transparent",borderColor:"line"===D?"#DC2626":"transparent",fill:"line"===D,tension:"line"===D?.4:0,borderWidth:"line"===D?2:0,pointBackgroundColor:"line"===D?"#DC2626":"transparent"}]}},S={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{color:"#555"}}},scales:{x:{ticks:{color:"#888"},grid:{display:!1}},y:{ticks:{color:"#888"},grid:{color:"#e5e7eb"},beginAtZero:!0}}};return(0,u.jsxs)("div",{className:"w-full  hover:shadow-blue-500/50 transition px-6 py-6 border p-6 mt-8 bg-white dark:bg-gray-800 rounded-3xl shadow-lg transition-all duration-300 ease-in-out",children:[(0,u.jsxs)("button",{className:"w-full text-left mb-4 text-blue-500 dark:text-blue-300 flex justify-between items-center",onClick:()=>v((e=>!e)),children:[(0,u.jsx)("span",{className:"text-lg font-semibold",children:"Uptime Analytics"}),w?(0,u.jsx)(l.A,{}):(0,u.jsx)(c.A,{})]}),(0,u.jsxs)("div",{className:"transition-all duration-300 ease-in-out overflow-hidden "+(w?"max-h-[800px] opacity-100":"max-h-0 opacity-0"),children:[(0,u.jsxs)("div",{className:"flex flex-wrap gap-4 mb-4",children:[["session","day"].map((e=>(0,u.jsxs)("button",{onClick:()=>E(e),className:"px-4 py-2 rounded-md "+(y===e?"bg-blue-500 text-white":"bg-gray-200"),children:["session"===e?"Session":"Day"," View"]},e))),["bar","line"].map((e=>(0,u.jsxs)("button",{onClick:()=>C(e),className:"px-4 py-2 rounded-md text-sm "+(D===e?"bg-green-500 text-white":"bg-gray-200"),children:["bar"===e?"Bar":"Line"," Chart"]},e)))]}),(0,u.jsx)("div",{className:"flex-1 min-h-[300px] mb-6",children:j?(0,u.jsx)("div",{className:"w-full h-[260px] bg-gray-200 dark:bg-gray-700 animate-pulse rounded"}):"bar"===D?(0,u.jsx)(r.Bar,{data:getData(),options:S}):(0,u.jsx)(r.Line,{data:getData(),options:S})}),(0,u.jsx)("div",{className:"flex flex-col lg:flex-row gap-6",children:[{label:"Total Network Time",val:d},{label:"Today\u2019s Time",val:m}].map(((e,t)=>{let{label:a,val:s}=e;return(0,u.jsxs)("div",{className:"bg-gray-200 dark:bg-gray-700 p-4 rounded-md shadow flex-1 transition-all duration-300",children:[(0,u.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a}),j?(0,u.jsx)("div",{className:"w-2/3 h-6 bg-gray-300 dark:bg-gray-600 rounded animate-pulse mt-2"}):(0,u.jsxs)("p",{className:"text-2xl font-mono text-black dark:text-white mt-2",children:[s.hours,"h ",s.minutes,"m"]})]},t)}))})]})]})}},6058:(e,t,a)=>{a.r(t),a.d(t,{Bar:()=>l,Bubble:()=>f,Chart:()=>o,Doughnut:()=>u,Line:()=>i,Pie:()=>m,PolarArea:()=>d,Radar:()=>c,Scatter:()=>h,getDatasetAtEvent:()=>getDatasetAtEvent,getElementAtEvent:()=>getElementAtEvent,getElementsAtEvent:()=>getElementsAtEvent});var s=a(5043),n=a(7304);const r="label";function reforwardRef(e,t){"function"===typeof e?e(t):e&&(e.current=t)}function setLabels(e,t){e.labels=t}function setDatasets(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r;const s=[];e.datasets=t.map((t=>{const n=e.datasets.find((e=>e[a]===t[a]));return n&&t.data&&!s.includes(n)?(s.push(n),Object.assign(n,t),n):{...t}}))}function cloneData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r;const a={labels:[],datasets:[]};return setLabels(a,e.labels),setDatasets(a,e.datasets,t),a}function getDatasetAtEvent(e,t){return e.getElementsAtEventForMode(t.nativeEvent,"dataset",{intersect:!0},!1)}function getElementAtEvent(e,t){return e.getElementsAtEventForMode(t.nativeEvent,"nearest",{intersect:!0},!1)}function getElementsAtEvent(e,t){return e.getElementsAtEventForMode(t.nativeEvent,"index",{intersect:!0},!1)}function ChartComponent(e,t){const{height:a=150,width:r=300,redraw:o=!1,datasetIdKey:i,type:l,data:c,options:u,plugins:d=[],fallbackContent:f,updateMode:m,...h}=e,p=(0,s.useRef)(null),b=(0,s.useRef)(null),renderChart=()=>{p.current&&(b.current=new n.t1(p.current,{type:l,data:cloneData(c,i),options:u&&{...u},plugins:d}),reforwardRef(t,b.current))},destroyChart=()=>{reforwardRef(t,null),b.current&&(b.current.destroy(),b.current=null)};return(0,s.useEffect)((()=>{!o&&b.current&&u&&function setOptions(e,t){const a=e.options;a&&t&&Object.assign(a,t)}(b.current,u)}),[o,u]),(0,s.useEffect)((()=>{!o&&b.current&&setLabels(b.current.config.data,c.labels)}),[o,c.labels]),(0,s.useEffect)((()=>{!o&&b.current&&c.datasets&&setDatasets(b.current.config.data,c.datasets,i)}),[o,c.datasets]),(0,s.useEffect)((()=>{b.current&&(o?(destroyChart(),setTimeout(renderChart)):b.current.update(m))}),[o,u,c.labels,c.datasets,m]),(0,s.useEffect)((()=>{b.current&&(destroyChart(),setTimeout(renderChart))}),[l]),(0,s.useEffect)((()=>(renderChart(),()=>destroyChart())),[]),s.createElement("canvas",{ref:p,role:"img",height:a,width:r,...h},f)}const o=(0,s.forwardRef)(ChartComponent);function createTypedChart(e,t){return n.t1.register(t),(0,s.forwardRef)(((t,a)=>s.createElement(o,{...t,ref:a,type:e})))}const i=createTypedChart("line",n.ZT),l=createTypedChart("bar",n.A6),c=createTypedChart("radar",n.h9),u=createTypedChart("doughnut",n.ju),d=createTypedChart("polarArea",n.G5),f=createTypedChart("bubble",n.Jb),m=createTypedChart("pie",n.P$),h=createTypedChart("scatter",n.Pz)}}]);
//# sourceMappingURL=883.bebd9f91.chunk.js.map