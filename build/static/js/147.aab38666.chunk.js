"use strict";(self.webpackChunkdigital_twin_app=self.webpackChunkdigital_twin_app||[]).push([[147,416],{147:(t,e,s)=>{s.r(e),s.d(e,{default:()=>d});var a=s(339),n=s(159),r=s(416),o=s(222),i=s(942),l=s(317),u=s(647),c=s(931);n.t1.register(n.E8,n.PP,n.No,n.kc,n.m_,n.s$);const d=()=>{const[t,e]=(0,a.useState)([]),[s,n]=(0,a.useState)([]),[d,f]=(0,a.useState)({hours:0,minutes:0}),[m,b]=(0,a.useState)({hours:0,minutes:0}),[g,p]=(0,a.useState)(""),[h,x]=(0,a.useState)(""),[w,v]=(0,a.useState)(!1),[y,E]=(0,a.useState)("session"),[D,j]=(0,a.useState)("bar"),[k,S]=(0,a.useState)(!1),N=(0,o.aU)(),A=(0,i.xI)();(0,a.useEffect)((()=>{let t,e;const s=async()=>{clearInterval(t);const s=A.currentUser;if(s&&e){const t=(0,o.H9)(N,"users",s.uid,"sessions",e);await(0,o.mZ)(t,{active:!1})}};return(0,i.hg)(A,(s=>{s&&(async s=>{const a=await(0,o.gS)((0,o.rJ)(N,"users",s.uid,"sessions"),{start:(0,o.O5)(),duration:0,active:!0});e=a.id;const n=(0,o.H9)(N,"users",s.uid,"sessions",e);t=setInterval((async()=>{const t=await(0,o.x7)(n);if(t.exists()){const e=t.data().duration||0;await(0,o.mZ)(n,{duration:e+60,lastUpdated:(0,o.O5)()})}}),6e4)})(s)})),window.addEventListener("beforeunload",s),()=>{clearInterval(t),window.removeEventListener("beforeunload",s)}}),[]),(0,a.useEffect)((()=>{(async()=>{const t=await(0,o.GG)((0,o.rJ)(N,"users"));let s=[];for(const e of t.docs){const t=e.id,a=(0,o.P)((0,o.rJ)(N,"users",t,"sessions"),(0,o.My)("start","asc"));(await(0,o.GG)(a)).forEach((e=>s.push({...e.data(),userId:t})))}e(s)})()}),[]),(0,a.useEffect)((()=>{(()=>{let e=0,s=0;const a=new Date,r=new Date;r.setHours(0,0,0,0);const o=g?new Date(g):null,i=h?new Date(h):null,l=t.filter((t=>{if(!t.start)return!1;const e=t.start.toDate?t.start.toDate():new Date(1e3*t.start.seconds);return(t.duration||0)>0&&(!o||e>=o)&&(!i||e<=i)}));l.forEach((t=>{const n=t.start.toDate?t.start.toDate():new Date(1e3*t.start.seconds),o=t.duration||0;e+=o;const i=new Date(n.getTime()+1e3*o),l=n<r?r:n,u=i>a?a:i;u>l&&(s+=Math.floor((u-l)/1e3))})),n(l),f({hours:Math.floor(e/3600),minutes:Math.floor(e%3600/60)}),b({hours:Math.floor(s/3600),minutes:Math.floor(s%3600/60)})})()}),[t,g,h]),(0,a.useEffect)((()=>{if(w){S(!0);const t=setTimeout((()=>S(!1)),3e3);return()=>clearTimeout(t)}}),[w]);const C=()=>{const t="session"===y?s.map((t=>(t.duration||0)/3600)):Object.values(s.reduce(((t,e)=>{const s=(e.start.toDate?e.start.toDate():new Date(1e3*e.start.seconds)).toDateString();return t[s]=(t[s]||0)+(e.duration||0),t}),{})).map((t=>t/3600));return{labels:"session"===y?s.map(((t,e)=>`Session ${e+1}`)):Object.keys(s.reduce(((t,e)=>{const s=(e.start.toDate?e.start.toDate():new Date(1e3*e.start.seconds)).toDateString();return t[s]=(t[s]||0)+(e.duration||0),t}),{})),datasets:[{label:"session"===y?"Session Duration (hrs)":"Day Duration (hrs)",data:t,backgroundColor:"bar"===D?"#FF7F50":"transparent",borderColor:"line"===D?"#DC2626":"transparent",fill:"line"===D,tension:"line"===D?.4:0,borderWidth:"line"===D?2:0,pointBackgroundColor:"line"===D?"#DC2626":"transparent"}]}},M={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{color:"#555"}}},scales:{x:{ticks:{color:"#888"},grid:{display:!1}},y:{ticks:{color:"#888"},grid:{color:"#e5e7eb"},beginAtZero:!0}}};return(0,c.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 mt-8 rounded-3xl shadow border w-full transition-all duration-300 ease-in-out",children:[(0,c.jsxs)("button",{className:"w-full text-left mb-4 text-blue-500 dark:text-blue-300 flex justify-between items-center",onClick:()=>v((t=>!t)),children:[(0,c.jsx)("span",{className:"text-lg font-semibold",children:"Uptime Analytics"}),w?(0,c.jsx)(l.A,{}):(0,c.jsx)(u.A,{})]}),(0,c.jsxs)("div",{className:"transition-all duration-300 ease-in-out overflow-hidden "+(w?"max-h-[800px] opacity-100":"max-h-0 opacity-0"),children:[(0,c.jsxs)("div",{className:"flex flex-wrap gap-4 mb-4",children:[["session","day"].map((t=>(0,c.jsxs)("button",{onClick:()=>E(t),className:"px-4 py-2 rounded-md "+(y===t?"bg-blue-500 text-white":"bg-gray-200"),children:["session"===t?"Session":"Day"," View"]},t))),["bar","line"].map((t=>(0,c.jsxs)("button",{onClick:()=>j(t),className:"px-4 py-2 rounded-md text-sm "+(D===t?"bg-green-500 text-white":"bg-gray-200"),children:["bar"===t?"Bar":"Line"," Chart"]},t)))]}),(0,c.jsx)("div",{className:"flex-1 min-h-[300px] mb-6",children:k?(0,c.jsx)("div",{className:"w-full h-[260px] bg-gray-200 dark:bg-gray-700 animate-pulse rounded"}):"bar"===D?(0,c.jsx)(r.Bar,{data:C(),options:M}):(0,c.jsx)(r.Line,{data:C(),options:M})}),(0,c.jsx)("div",{className:"flex flex-col lg:flex-row gap-6",children:[{label:"Total Network Time",val:d},{label:"Today\u2019s Time",val:m}].map(((t,e)=>{let{label:s,val:a}=t;return(0,c.jsxs)("div",{className:"bg-gray-200 dark:bg-gray-700 p-4 rounded-md shadow flex-1 transition-all duration-300",children:[(0,c.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s}),k?(0,c.jsx)("div",{className:"w-2/3 h-6 bg-gray-300 dark:bg-gray-600 rounded animate-pulse mt-2"}):(0,c.jsxs)("p",{className:"text-2xl font-mono text-black dark:text-white mt-2",children:[a.hours,"h ",a.minutes,"m"]})]},e)}))})]})]})}},416:(t,e,s)=>{s.r(e),s.d(e,{Bar:()=>h,Bubble:()=>y,Chart:()=>b,Doughnut:()=>w,Line:()=>p,Pie:()=>E,PolarArea:()=>v,Radar:()=>x,Scatter:()=>D,getDatasetAtEvent:()=>c,getElementAtEvent:()=>d,getElementsAtEvent:()=>f});var a=s(339),n=s(159);const r="label";function o(t,e){"function"===typeof t?t(e):t&&(t.current=e)}function i(t,e){t.labels=e}function l(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r;const a=[];t.datasets=e.map((e=>{const n=t.datasets.find((t=>t[s]===e[s]));return n&&e.data&&!a.includes(n)?(a.push(n),Object.assign(n,e),n):{...e}}))}function u(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r;const s={labels:[],datasets:[]};return i(s,t.labels),l(s,t.datasets,e),s}function c(t,e){return t.getElementsAtEventForMode(e.nativeEvent,"dataset",{intersect:!0},!1)}function d(t,e){return t.getElementsAtEventForMode(e.nativeEvent,"nearest",{intersect:!0},!1)}function f(t,e){return t.getElementsAtEventForMode(e.nativeEvent,"index",{intersect:!0},!1)}function m(t,e){const{height:s=150,width:r=300,redraw:c=!1,datasetIdKey:d,type:f,data:m,options:b,plugins:g=[],fallbackContent:p,updateMode:h,...x}=t,w=(0,a.useRef)(null),v=(0,a.useRef)(null),y=()=>{w.current&&(v.current=new n.t1(w.current,{type:f,data:u(m,d),options:b&&{...b},plugins:g}),o(e,v.current))},E=()=>{o(e,null),v.current&&(v.current.destroy(),v.current=null)};return(0,a.useEffect)((()=>{!c&&v.current&&b&&function(t,e){const s=t.options;s&&e&&Object.assign(s,e)}(v.current,b)}),[c,b]),(0,a.useEffect)((()=>{!c&&v.current&&i(v.current.config.data,m.labels)}),[c,m.labels]),(0,a.useEffect)((()=>{!c&&v.current&&m.datasets&&l(v.current.config.data,m.datasets,d)}),[c,m.datasets]),(0,a.useEffect)((()=>{v.current&&(c?(E(),setTimeout(y)):v.current.update(h))}),[c,b,m.labels,m.datasets,h]),(0,a.useEffect)((()=>{v.current&&(E(),setTimeout(y))}),[f]),(0,a.useEffect)((()=>(y(),()=>E())),[]),a.createElement("canvas",{ref:w,role:"img",height:s,width:r,...x},p)}const b=(0,a.forwardRef)(m);function g(t,e){return n.t1.register(e),(0,a.forwardRef)(((e,s)=>a.createElement(b,{...e,ref:s,type:t})))}const p=g("line",n.ZT),h=g("bar",n.A6),x=g("radar",n.h9),w=g("doughnut",n.ju),v=g("polarArea",n.G5),y=g("bubble",n.Jb),E=g("pie",n.P$),D=g("scatter",n.Pz)}}]);
//# sourceMappingURL=147.aab38666.chunk.js.map